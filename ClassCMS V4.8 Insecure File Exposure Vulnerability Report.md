# Insecure File Exposure Vulnerability Report

## Description
An insecure file exposure vulnerability exists in ClassCMS V4.8. This vulnerability allows attackers to exploit short file names to directly download sensitive files, such as the SQLite database file. Since the database file is stored in the root directory of the website, an attacker can use this method to access sensitive data, including administrator usernames and passwords.

## Download URL
[https://github.com/ClassCMS/ClassCMS/releases/tag/v4.8](https://github.com/ClassCMS/ClassCMS/releases/tag/v4.8)

## Version
V4.8

## Tested Environment
- PHP
- Apache
- SQLite

## Affected Page
Website root directory (e.g., `/`)

## Vulnerability Details
ClassCMS supports SQLite as a database option, and the SQLite database file is stored in the root directory of the website. Due to improper access control, attackers can use short file names to directly download the database file. Once the file is downloaded, the attacker can extract sensitive information such as administrator account credentials, leading to severe security risks.

## Proof of Vulnerability
## Proof of Vulnerability

1. The system's source code defaults to using SQLite as the database during installation. On the CMS installation interface, you can observe that the SQLite database file name is randomly generated, but it typically follows the default naming convention `db_xxxxxxxxxx.db`.

   Host A:
   ![image](https://github.com/user-attachments/assets/ff7fce7e-c859-41b3-a72f-929cdfd1798d)

   Host B:
   ![image](https://github.com/user-attachments/assets/be35fe70-f308-48e4-bc7e-73e3626b98bf)

2. Fill in the required information and proceed with the installation.
![image](https://github.com/user-attachments/assets/9791ad5a-ccfe-449c-b551-071ac0014934)
![image](https://github.com/user-attachments/assets/e0f6db35-4499-45c7-af9c-8378c5614a27)

3. After the installation is successful, we access the homepage of the system. Based on the rules generated by the system's configuration files, we can infer that the short file name of the SQLite database is likely `DB_XXX~1.DB`. This means we only need to calculate combinations of 3 letters and numbers to download the database file. We then construct the following data packet:

```http
GET /DB_XXX~1.DB HTTP/1.1
Host: 192.168.81.129
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: token_595ef5=af8c0ed16b681679b01a3df5b237c6a3; csrf_595ef5=1c1e3e9a
Connection: close
```
![image](https://github.com/user-attachments/assets/3db37ade-bb5c-45c1-8eef-1f0ea4a17155)

4. Configure replacement points in the data packet. Set the replacement position to `XXX`, and use `Brute Forcer` as the payload. Then, set the minimum and maximum length to 3. For the `character set`, use `abcdefghijklmnopqrstuvwxyz0123456789`. Start the brute force process, and you should be able to retrieve the file.

![image](https://github.com/user-attachments/assets/381dc20d-57d3-4ac4-bb04-b7fc14813252)
![image](https://github.com/user-attachments/assets/1aa2c710-30b9-4891-b636-cf4ef407058f)

5. Start the brute force process and wait. Sort the results based on length or status. The resulting file name is `DB_fdd~1.DB`.（Maximum attempts: 46,656）

![image](https://github.com/user-attachments/assets/f38b2b7d-cd0d-4f7b-9fd5-c1fc05916060)

6.Access the following address to download the database file:  http://192.168.81.129/DB_fdd~1.DB
![image](https://github.com/user-attachments/assets/24905443-e454-47f5-8b84-da587233e728)

7. Use the **SQLite Expert Personal** tool to open the database file and retrieve all the information stored in the system's database, including account credentials and passwords.

![image](https://github.com/user-attachments/assets/99cafdd9-9436-4974-8c7c-dc1e9172f017)
![image](https://github.com/user-attachments/assets/0c7028bf-1d02-40b9-8777-deb35b8f06fe)

8. To access the backend, you can use MD5 decryption websites to crack the retrieved MD5 hashes.

![image](https://github.com/user-attachments/assets/98d0093e-3869-4434-82f8-977160de284b)

The entire database is in my hands, and all the information has been leaked.
